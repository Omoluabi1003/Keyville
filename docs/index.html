<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#7ce3ff" />
  <meta name="application-name" content="Keyville" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta
    name="description"
    content="A grade-6 friendly language escape room with looping rooms, confetti celebrations, chiptune music, and offline play."
  />
  <title>The Lexicon Detective Escape Room</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-512.svg" />
  <meta name="msapplication-TileColor" content="#0f1c33" />
</head>
  <body>
  <div id="toast-container" class="toast-container" aria-live="polite"></div>
  <div id="victory-sound-player" class="sr-audio" aria-hidden="true"></div>
  <div id="transition-overlay" class="hidden" role="status" aria-live="polite" aria-hidden="true">
    <div class="transition-card">
      <p class="eyebrow" id="transition-label">Transition</p>
      <h3 id="transition-title">Next room unlocked</h3>
      <p id="transition-body">Get ready for the next challenge.</p>
      <div class="transition-progress">
        <div class="transition-progress-fill" id="transition-progress"></div>
      </div>
    </div>
  </div>
  <div class="page">
    <header>
      <div class="badge">Grade 6</div>
      <div>
        <p class="eyebrow">Language Game</p>
        <h1>The Lexicon Detective Escape Room</h1>
        <p class="subtitle">Crack every clue across endlessly looping rooms to earn your Chief Language Officer badge! Content and rubrics are locked to the canonical spec below.</p>
        <div class="cold-open" role="note">
          <p class="eyebrow">Cold open</p>
          <p>The lights flicker. Headquarters radios in: “Keyville needs a Chief Language Officer.” You are dropped into an active investigation with only your detective kit and the rooms ahead.</p>
        </div>
      </div>
    </header>

    <main>
      <div class="layout">
        <div class="content">
          <section class="card map-card" aria-label="Room accordion navigation">
            <div class="card-header">
              <div>
                <p class="eyebrow">Active-room focus</p>
                <h2>Navigate the investigation</h2>
              </div>
              <span class="tag">Map</span>
            </div>
            <p class="lead">Open the accordion to jump between rooms. Only the active room stays expanded; others collapse with status chips (Locked, Active, Cleared).</p>
            <details id="map-accordion" open>
              <summary aria-label="Toggle room map">Room map</summary>
              <div id="accordion-body" class="accordion-body"></div>
            </details>
          </section>

          <section class="card intro-card">
            <div class="card-header">
              <div>
                <p class="eyebrow">Player Hub</p>
                <h2>Set your detective badge</h2>
              </div>
              <span class="tag">Start here</span>
            </div>
            <p class="lead">Pick a code name and squad, then jump into the active room or restart with a clean slate.</p>
            <form id="profile-form" class="profile-form">
              <label class="field">
                <span>Detective code name</span>
                <input type="text" id="player-name" name="player-name" placeholder="E.g., Star Reader" autocomplete="name" />
              </label>
              <label class="field">
                <span>Squad or homeroom (optional)</span>
                <input type="text" id="player-team" name="player-team" placeholder="E.g., Team Griffin" autocomplete="organization" />
              </label>
              <div class="profile-actions">
                <button class="primary" type="submit" aria-label="Save player badge">Save badge</button>
                <button class="secondary" type="button" id="start-button" aria-label="Start or resume the active room">Start / Resume adventure</button>
                <button class="ghost" type="button" id="reset-progress" aria-label="Reset progress with new questions">Reset progress</button>
                <button class="ghost" type="button" id="new-case" aria-label="Load a new randomized case">New case</button>
                <button class="ghost" type="button" id="practice-mode" aria-label="Launch a demo run without saving">Demo run</button>
              </div>
            </form>
            <div class="orientation">
              <p class="eyebrow">Game map</p>
              <ul>
                <li>5 rooms per stage with instant feedback and auto-save—stages keep rolling.</li>
                <li>Use the Start / Resume button to jump back into the next task.</li>
                <li>Need a fresh try? Reset progress without losing your badge.</li>
                <li>Teacher mode reveals rubrics, answers, and rationales without touching the student flow.</li>
                <li>Every 10 stages earns a special milestone badge to celebrate perseverance.</li>
              </ul>
            </div>
          </section>

          <section class="progress-card">
            <div class="progress-label">
              <span id="progress-text">Stage 1 · Room 1 of 5</span>
              <span id="progress-hint">Vocabulary Vault</span>
            </div>
            <div class="progress">
              <div class="progress-fill" id="progress-fill" style="width: 20%"></div>
            </div>
            <div class="progress-meta">
              <span id="progress-percent">0% complete</span>
              <span id="room-map-summary"></span>
            </div>
            <div class="progress-bar-meta" aria-live="polite">
              <p id="mastery-label" class="eyebrow">Room mastery: 0%</p>
              <p class="microcopy" id="mastery-copy">Start a task to see live mastery feedback.</p>
            </div>
            <div class="compact-map" aria-label="Room map" role="navigation">
              <div id="room-map" class="room-map"></div>
            </div>
            <div id="badge-shelf" class="badge-shelf" aria-live="polite"></div>
          </section>

          <section class="card" id="room-0">
            <div class="card-header">
              <div>
                <p class="eyebrow">Room 1</p>
                <h2>Vocabulary Vault</h2>
              </div>
              <span class="tag">Match &amp; Unlock</span>
            </div>
            <p class="lead" id="vocab-objective">Match each word with the correct definition to swing the vault door open.</p>
            <form id="vocab-form" class="stack">
              <div id="vocab-rows" class="stack"></div>
              <div class="options-list" id="definition-options"></div>
              <div class="inline-hints" id="vocab-inline-hint"></div>
              <div class="inline-hints" id="vocab-microcopy" aria-live="polite"></div>
              <button class="primary" type="submit">Check matches</button>
            </form>
            <div class="teacher-card" data-room="vocab"></div>
          </section>

          <section class="card hidden" id="room-1">
            <div class="card-header">
              <div>
                <p class="eyebrow">Room 2</p>
                <h2>Grammar Detective Bureau</h2>
              </div>
              <span class="tag">Fix It</span>
            </div>
            <p class="lead" id="grammar-objective">Repair the sentence so it follows grammar rules. Keep meaning the same.</p>
            <div class="prompt-box">
              <p class="eyebrow">Flawed sentence</p>
              <p class="quote" id="grammar-flawed"></p>
            </div>
            <label class="field">
              <span>Your corrected sentence</span>
              <input type="text" id="grammar-input" placeholder="Write the corrected sentence" />
            </label>
            <div class="inline-hints" id="grammar-example"></div>
            <div class="inline-hints" id="grammar-checklist" aria-live="polite"></div>
            <div class="profile-actions">
              <button class="secondary" id="grammar-hint" type="button" aria-label="Get a grammar hint">Get one hint</button>
              <button class="primary" id="grammar-check">Submit correction</button>
            </div>
            <div class="teacher-card" data-room="grammar"></div>
          </section>

          <section class="card hidden" id="room-2">
            <div class="card-header">
              <div>
                <p class="eyebrow">Room 3</p>
                <h2>Figurative Language Lab</h2>
              </div>
              <span class="tag">Identify</span>
            </div>
            <p class="lead" id="fig-objective">Pick whether each clue is a simile, metaphor, or personification.</p>
            <div id="figurative-list" class="stack"></div>
            <div class="inline-hints" id="fig-microcopy"></div>
            <button class="primary" id="figurative-check">Lock in answers</button>
            <div class="teacher-card" data-room="fig"></div>
          </section>

          <section class="card hidden" id="room-3">
            <div class="card-header">
              <div>
                <p class="eyebrow">Room 4</p>
                <h2>Synonym–Antonym Arena</h2>
              </div>
              <span class="tag">Double Duty</span>
            </div>
            <p class="lead" id="syn-objective">For each target word, enter one synonym and one antonym.</p>
            <form id="syn-ant-form" class="stack">
              <div class="dual-field" id="syn-rows"></div>
              <div class="inline-hints" id="syn-inline-hint"></div>
              <div class="inline-hints" id="syn-microcopy"></div>
              <button class="primary" type="submit">Submit pairs</button>
            </form>
            <div class="teacher-card" data-room="synAnt"></div>
          </section>

          <section class="card hidden" id="room-4">
            <div class="card-header">
              <div>
                <p class="eyebrow">Room 5</p>
                <h2>Executive Story Spin</h2>
              </div>
              <span class="tag">Create</span>
            </div>
            <p class="lead" id="story-objective">Write a 4–5 sentence micro-story that includes a forest, a mysterious sound, the word "reluctant," and one simile.</p>
            <div class="requirements" id="story-requirements"></div>
            <div class="prompt-box simile-bank">
              <p class="eyebrow">Simile bank</p>
              <p id="simile-bank"></p>
            </div>
            <label class="field">
              <span>Your story</span>
              <textarea id="story-input" rows="6" placeholder="Spin your mini story here..."></textarea>
            </label>
            <div class="inline-hints" id="story-checklist" aria-live="polite"></div>
            <div class="inline-hints" id="story-microcopy"></div>
            <button class="primary" id="story-submit">Complete the journey</button>
            <div class="teacher-card" data-room="story"></div>
          </section>

          <section class="card hidden" id="win-screen">
            <div class="card-header">
              <div>
                <p class="eyebrow">Victory</p>
                <h2>Chief Language Officer (CLO), Grade 6 Division</h2>
              </div>
              <span class="tag success">Unlocked</span>
            </div>
            <p class="lead">You escaped every room! Review your detective notes below and celebrate your word mastery.</p>
            <div id="summary"></div>
            <div class="actions">
              <button class="secondary" id="restart">Play again</button>
              <button class="primary" id="print-badge" aria-label="Print or share CLO badge">Print / Share badge</button>
            </div>
          </section>

          <div id="feedback" role="status" aria-live="polite"></div>
        </div>

        <aside class="hud">
          <section class="card toolkit">
            <div class="card-header">
              <div>
                <p class="eyebrow">Detective Toolkit</p>
                <h2>Room Status</h2>
              </div>
              <span class="tag">Live</span>
            </div>
            <p class="lead">Watch each room flip from locked, to active, to cleared as you play.</p>
            <div id="status-line" class="status-line">Start with Room 1: Vocabulary Vault</div>
            <div id="room-status" class="room-status"></div>
            <div class="tips">
              <p class="eyebrow">Quick tips</p>
              <ul>
                <li>Use the word bank before locking answers.</li>
                <li>Feedback below the cards guides your next move.</li>
                <li>Your progress auto-saves—refreshing won't reset the journey.</li>
              </ul>
            </div>
            <div class="controls">
              <button class="secondary" type="button" id="teacher-toggle">Teacher mode</button>
              <button class="secondary" type="button" id="contrast-toggle" aria-pressed="false">High contrast</button>
              <button class="secondary" type="button" id="audio-toggle" aria-pressed="false">Ambient audio</button>
            </div>
            <div class="telemetry" id="telemetry-readout"></div>
            <section class="admin-panel" aria-label="Admin and exports">
              <div class="card-header">
                <div>
                  <p class="eyebrow">Admin panel</p>
                  <h3>Exports & Filters</h3>
                </div>
                <span class="tag">Teacher</span>
              </div>
              <label class="field">
                <span>Filter by squad</span>
                <input id="filter-squad" type="text" placeholder="Team Griffin" />
              </label>
              <label class="field">
                <span>Filter by room</span>
                <select id="filter-room">
                  <option value="all">All rooms</option>
                  <option value="0">Room 1</option>
                  <option value="1">Room 2</option>
                  <option value="2">Room 3</option>
                  <option value="3">Room 4</option>
                  <option value="4">Room 5</option>
                </select>
              </label>
              <label class="field">
                <span>Date window</span>
                <input type="date" id="filter-date" />
              </label>
              <div class="controls">
                <button class="secondary" type="button" id="export-telemetry">Export telemetry</button>
                <button class="secondary" type="button" id="export-telemetry-csv">Export CSV</button>
                <button class="secondary" type="button" id="class-summary">Class summary</button>
              </div>
              <div id="summary-readout" class="telemetry"></div>
            </section>
            <section class="teacher-dashboard" id="teacher-dashboard" aria-live="polite">
              <div class="card-header">
                <div>
                  <p class="eyebrow">Teacher Dashboard</p>
                  <h3>Roster progress</h3>
                </div>
                <span class="tag">Admin</span>
              </div>
              <div id="teacher-roster" class="roster"></div>
              <label class="field" aria-label="Manual room unlock">
                <span>Manual unlock (teacher proofing)</span>
                <select id="unlock-controls">
                  <option value="" disabled selected>Choose room to unlock</option>
                  <option value="0">Room 1</option>
                  <option value="1">Room 2</option>
                  <option value="2">Room 3</option>
                  <option value="3">Room 4</option>
                  <option value="4">Room 5</option>
                </select>
              </label>
              <button class="secondary" type="button" id="reset-room">Reset active room</button>
            </section>
          </section>
        </aside>
      </div>
    </main>
  </div>
  <script src="gameData.js"></script>
  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(() => {});
    }
  </script>
</body>
</html>
